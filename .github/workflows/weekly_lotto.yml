name: OOTD Weekly Lottery

on:
  schedule:
    # æ¯å‘¨äºŒçº½çº¦æ—¶é—´ 21:30 (UTC å‘¨ä¸‰ 01:30)
    - cron: '30 1 * * 3'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨æµ‹è¯•

jobs:
  run-lottery:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    # ğŸ‘‡ğŸ‘‡ğŸ‘‡ æ ¸å¿ƒä¿®å¤ï¼šè‡ªåŠ¨ç”Ÿæˆç¼ºå¤±çš„ package.json ğŸ‘‡ğŸ‘‡ğŸ‘‡
    - name: Generate package.json if missing
      run: |
        if [ ! -f package.json ]; then
          echo "âš ï¸ package.json not found, generating one automatically..."
          echo '{
            "name": "ootd-lottery-bot",
            "version": "1.0.0",
            "main": "ootd_lottery_bot.js",
            "license": "ISC",
            "dependencies": {
              "@solana/spl-token": "^0.3.9",
              "@solana/web3.js": "^1.87.6",
              "bs58": "^4.0.1",
              "dotenv": "^16.3.1"
            }
          }' > package.json
        else
          echo "âœ… package.json found!"
        fi
        # æ‰“å°å‡ºæ¥çœ‹çœ‹å†…å®¹å¯¹ä¸å¯¹
        cat package.json
    # ğŸ‘†ğŸ‘†ğŸ‘† ä¿®å¤ç»“æŸ ğŸ‘†ğŸ‘†ğŸ‘†

    - name: Install dependencies
      run: npm install

    - name: Run Lottery Script
      env:
        RPC_URL: ${{ secrets.RPC_URL }}
        PAYER_PRIVATE_KEY: ${{ secrets.PAYER_PRIVATE_KEY }}
      run: node ootd_lottery_bot.js
